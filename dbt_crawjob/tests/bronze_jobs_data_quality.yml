version: 2

# Test data quality for bronze jobs table
tests:
  # Test not null constraints
  - name: test_bronze_jobs_job_url_not_null
    model: jobs
    schema: bronze
    column_name: job_url
    test_type: not_null

  - name: test_bronze_jobs_job_title_not_null
    model: jobs
    schema: bronze
    column_name: job_title
    test_type: not_null

  - name: test_bronze_jobs_company_name_not_null
    model: jobs
    schema: bronze
    column_name: company_name
    test_type: not_null

  - name: test_bronze_jobs_source_site_not_null
    model: jobs
    schema: bronze
    column_name: source_site
    test_type: not_null

  - name: test_bronze_jobs_scraped_at_not_null
    model: jobs
    schema: bronze
    column_name: scraped_at
    test_type: not_null

  - name: test_bronze_jobs_scraped_date_not_null
    model: jobs
    schema: bronze
    column_name: scraped_date
    test_type: not_null

  # Test uniqueness constraints
  - name: test_bronze_jobs_job_url_unique
    model: jobs
    schema: bronze
    column_name: job_url
    test_type: unique

  # Test data quality - reasonable string lengths
  - name: test_bronze_jobs_job_title_length
    model: jobs
    schema: bronze
    column_name: job_title
    test_type: generic
    sql: |
      select job_url
      from {{ source('bronze', 'jobs') }}
      where length(trim(job_title)) < 5
         or length(trim(job_title)) > 200

  - name: test_bronze_jobs_company_name_length
    model: jobs
    schema: bronze
    column_name: company_name
    test_type: generic
    sql: |
      select job_url
      from {{ source('bronze', 'jobs') }}
      where length(trim(company_name)) < 2
         or length(trim(company_name)) > 100

  # Test data freshness - scraped_at should be recent
  - name: test_bronze_jobs_freshness
    model: jobs
    schema: bronze
    test_type: generic
    sql: |
      select job_url
      from {{ source('bronze', 'jobs') }}
      where scraped_at < current_date - interval '7 days'

  # Test source_site values are valid
  - name: test_bronze_jobs_valid_source_sites
    model: jobs
    schema: bronze
    column_name: source_site
    test_type: accepted_values
    values:
      - 'careerlink.vn'
      - 'careerviet.vn'
      - 'itviec.com'
      - 'job123.com.vn'
      - 'joboko.com'
      - 'jobsgo.vn'
      - 'jobstreet.com.vn'
      - 'linkedin.com'
      - 'topcv.vn'
      - 'vietnamworks.com'